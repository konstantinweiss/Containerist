  <div class="stacker-ui containerist-ui">

    {{#editable}}
    <link rel="stylesheet" type="text/css" media="all" href="/{{module_dir}}res/style.css" />
    <div class="stacker">

      <h3><a href="/{{repo}}/{{slug}}?edit=stop">{{id}}</a></h3>
      
      <input id="stack_id"   type="hidden" name="stack_id"   value="{{id}}"   class="form-text" />
      <input id="stack_slug" type="hidden" name="stack_slug" value="{{slug}}" class="form-text" />
      <input id="stack_repo" type="hidden" name="stack_repo" value="{{repo}}" class="form-text" />

      <p class="stack_site">
        <label for="stack_site">Site: </label> 
        <input id="stack_site" type="text" maxlength="60" name="site" size="20" value="{{site}}" class="form-text" />
      </p>
      
      <ul class="sortable list ctn_list">
      {{#containers}}
        <li class="ctn_li">
          <span class="handle">::</span> 
          <a href="/{{repo}}/{{ . }}.ctn.edit">{{ . }}</a> <a href="#" class="remove">x</a>
        </li>
      {{/containers}}
      </ul>
      <select id="add_container">
        <!-- optgroup label="CONTAINER"-->
          <option value="none" todo--disabled selected>add an existing ...</option>
          {{#repo_containers}}
            <option value="{{ . }}">{{ . }}</option>
          {{/repo_containers}}
        <!-- /optgroup-->
        <!-- optgroup label="MODULES"-->
          {{#mod_containers}}
            <option value="{{ . }}">{{ . }}</option>
          {{/mod_containers}}
        <!-- /optgroup-->
      </select>
      or <input id="create_container" type="text" maxlength="60" size="28" value="create a container" class="form-text" />

    </div> <!-- end div.stacker -->
   
    <div class="edit-toggle">
      <a href="{{id}}?edit=stop" class="btn">X</a>
    </div>
    {{/editable}}

    {{^editable}}
    <!-- 
    <div class="containerist-ui">
      <div class="edit-toggle">
        <a href="{{admin}}" class="btn">Edit</a>
      </div>
    </div>
     -->
    {{/editable}} 

  </div> <!-- end div.containerist-ui -->



  {{#editable}}
  <script src="/{{module_dir}}res/jquery.min.js"></script>
  <script src="/{{module_dir}}res/jquery.sortable.min.js"></script>
  <script>

  $(function() {
    $('.sortable').sortable().bind('sortupdate', save_to_server);
    $('#stack_site').focusout (save_to_server);
    $('#add_container').change (add_container);
    $('#create_container').focusin (erase);
    $('#create_container').focusout (create_container);
    $("#create_container").keyup(function(event){
        if(event.keyCode == 13){
          create_container();
          erase ();
        }
    });
    $('.ctn_list').delegate(".remove", "click", remove_ctn);
    
    var stack_id   = $('#stack_id'),
        stack_slug = $('#stack_slug'),
        stack_site = $('#stack_site'),
        stack_repo = $('#stack_repo'),
        ctn_order  = check_order(),
        preview_div = $('.containers');
    
    function check_order() {
      ctns = $('.ctn_list').children();
      order = [];
      for (i=0;i<ctns.length;i++) {
        var ctn_id = $(ctns[i]).children('a').html();
        order.push(ctn_id);
      }
      return order;
    }
    
    function remove_ctn () {
      console.log (this);
      $(this).parent().remove();
      check_order();
      save_to_server();
    }
    
    function add_container () {
      var ctn_id = $('select#add_container').val();
      new_container (ctn_id);
    }
    
    function erase () {
      $('#create_container').val('');
    }
    
    function create_container () {
      var ctn_id = $('#create_container').val();
      if (ctn_id != "") {
        new_container (ctn_id);
      } else {
        $('#create_container').val('create a container');
      }
    }
    
    function new_container (ctn_id) {
      $('.ctn_list').append('<li><span class="handle">::</span> <a href="{{id}}/'+ctn_id+'.ctn.edit">'+ctn_id+'</a> <a href="#" class="remove">x</a></li>');
      $("#add_container").val('add an existing ...');
      $('.sortable').sortable().bind('sortupdate', save_to_server);
      save_to_server();
    }
    
    function save_to_server(event) {
      var php_get  = '/{{repo}}/stacker-update.mod?id='+stack_id.val(),
          php_load = '/{{repo}}/'+stack_slug.val()+'/stacker-view.mod',
          data_to_php = {
            id: stack_id.val(),
            slug: stack_slug.val(),
            containers: check_order()
          },
          callback_get = function(response) {
            preview_div.load(php_load, data_to_php, callback_load);
            console.log (response);
          },
          callback_load = function(response) {
            containerist.init();
          };
      // filename, data to php, callback when php finishes
      $.get(php_get, data_to_php, callback_get);
    }
    
  });
  </script>
  {{/editable}}
